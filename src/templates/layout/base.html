<!DOCTYPE html>
<html lang="en">
{% load static %}

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <link rel="stylesheet" href="{% static 'css/styles.min.css' %}" />
  <link id="mode" rel="stylesheet" href="{% static 'css/main.css' %}" />
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“¦</text></svg>">

  <meta name="description" content="" />
  <meta name="keywords" content="" />
  <title>{{title}} | TheCollector</title>
</head>

<body>
  <header class="header">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="header__content">
            {% if user.is_authenticated %}
            <a href="{% url 'logout' %}" class="header__login"><svg xmlns="http://www.w3.org/2000/svg" width="512"
                height="512" viewBox="0 0 512 512">
                <path
                  d="M176,176V136a40,40,0,0,1,40-40H424a40,40,0,0,1,40,40V376a40,40,0,0,1-40,40H216a40,40,0,0,1-40-40V336"
                  style="fill: none; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px" />
                <polyline points="272 336 352 256 272 176"
                  style="fill: none; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px" />
                <line x1="48" y1="256" x2="336" y2="256"
                  style="fill: none; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px" />
              </svg><span>Logout</span></a>
            {% else %}
            <a href="{% url 'login' %}" class="header__login"><svg xmlns="http://www.w3.org/2000/svg" width="512"
                height="512" viewBox="0 0 512 512">
                <path
                  d="M176,176V136a40,40,0,0,1,40-40H424a40,40,0,0,1,40,40V376a40,40,0,0,1-40,40H216a40,40,0,0,1-40-40V336"
                  style="fill: none; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px" />
                <polyline points="272 336 352 256 272 176"
                  style="fill: none; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px" />
                <line x1="48" y1="256" x2="336" y2="256"
                  style="fill: none; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px" />
              </svg><span>Login</span></a>
            {% endif %}
            <button href="#" class="header__color" id="swap">
              <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512">
                <line x1="256" y1="48" x2="256" y2="96"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
                <line x1="256" y1="416" x2="256" y2="464"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
                <line x1="403.08" y1="108.92" x2="369.14" y2="142.86"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
                <line x1="142.86" y1="369.14" x2="108.92" y2="403.08"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
                <line x1="464" y1="256" x2="416" y2="256"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
                <line x1="96" y1="256" x2="48" y2="256"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
                <line x1="403.08" y1="403.08" x2="369.14" y2="369.14"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
                <line x1="142.86" y1="142.86" x2="108.92" y2="108.92"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
                <circle cx="256" cy="256" r="80"
                  style="fill: none; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px" />
              </svg>
            </button>
            <nav class="header__nav">
              {% if user.is_authenticated %}
              <a href="{% url 'home' %}">Home</a>
              <a href="{% url 'my_posts' %}">My Posts</a>
              <a href="{% url 'profile' %}">My profile</a>
              <a href="{% url 'about' %}">How to use</a>
              {% else %}
              <a href="{% url 'home' %}">Home</a>
              <a href="{% url 'register' %}">Register</a>
              <a href="{% url 'about' %}">How to use</a>
              {% endif %}
            </nav>
            <a href="{% url 'home' %}" class="header__logo">
              <img src="{% static 'img/logo.png' %}" alt="" />
            </a>
            <button class="header__menu" type="button">
              <span></span>
              <span></span>
              <span></span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  {% block content %} {% endblock %}

  <footer class="footer">
    <div class="container">
      <div class="row">
        <div class="col-12">
          <div class="footer__content">
            <small class="footer__copyright"></small>

            <a href="#" class="footer__logo">
              <img src="{% static 'img/logo.png' %}" alt="" />
            </a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script src="{% static 'js/scripts.min.js' %}"></script>
  <script src="{% static 'js/main.js' %}"></script>
  <script src="{% static 'js/swal.js' %}"></script>
  <script src="{% static 'js/bootstrap-notify.min.js' %}"></script>

  {% if messages %}
  {% for message in messages %}
  <script>
    Swal.fire({ text: "{{message}}", icon: "{{message.tags}}" });
  </script>
  {% endfor %}
  {% endif %}
  {% block script %} {% endblock %}


  {% if user.is_authenticated %}
  <style>
    .alert-success {
      color: #3c763d;
      background-color: #dff0d8;
      border-color: #d6e9c6;
    }

    .alert {
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 4px;
    }
  </style>
  <script>
    var socket = new WebSocket('ws://' + window.location.host + '/ws/notifier/');
    socket.onopen = function open() {
      console.log('WebSockets connection created.');
    };

    socket.onmessage = function recieve(message) {
      
      const data = JSON.parse(message.data);
      const post = data.event
      console.log(post)
      $.notifyClose();
      $.notify({
        // options
        title: 'new post collected',
        message: 'click here to see it ',
        url: `/post/${post.id}`,
        target: '_blank',
      }, {
        // settings
        type: 'success',
        allow_dismiss: true,
        newest_on_top: true,
        placement: {
          from: "bottom",
          align: "center",
        },
        delay: 0
      });

      if (window.location.pathname == '/home/' || window.location.pathname == '/') {
        $('.row.infinite-container').prepend(`
              <div class="col-12 col-md-6 col-lg-4 infinite-item">
                <div class="post">
                  <div class="post__img">
                    ${post.thumnail_photo}
                  </div>
                  <div class="post__meta">
                    <span>now</span>
                  </div>
                  <h3 class="post__title">${post.title}</h3>
                  <div class="post__wrap">
                    <a href="/post/${post.id}" class="post__link">Read more</a>
                    <div class="post__comments">
                      <svg xmlns='http://www.w3.org/2000/svg' width='512' height='512' viewBox='0 0 512 512'>
                        <path d='M431,320.6c-1-3.6,1.2-8.6,3.3-12.2a33.68,33.68,0,0,1,2.1-3.1A162,162,0,0,0,464,215c.3-92.2-77.5-167-173.7-167C206.4,48,136.4,105.1,120,180.9a160.7,160.7,0,0,0-3.7,34.2c0,92.3,74.8,169.1,171,169.1,15.3,0,35.9-4.6,47.2-7.7s22.5-7.2,25.4-8.3a26.44,26.44,0,0,1,9.3-1.7,26,26,0,0,1,10.1,2L436,388.6a13.52,13.52,0,0,0,3.9,1,8,8,0,0,0,8-8,12.85,12.85,0,0,0-.5-2.7Z'
                          style='fill:none;stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px'/>
                        <path d='M66.46,232a146.23,146.23,0,0,0,6.39,152.67c2.31,3.49,3.61,6.19,3.21,8s-11.93,61.87-11.93,61.87a8,8,0,0,0,2.71,7.68A8.17,8.17,0,0,0,72,464a7.26,7.26,0,0,0,2.91-.6l56.21-22a15.7,15.7,0,0,1,12,.2c18.94,7.38,39.88,12,60.83,12A159.21,159.21,0,0,0,284,432.11' 
                          style='fill:none;stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px'/>
                      </svg>
                      0
                    </div>
                  </div>
                </div>
              </div>`)
      }

    }
  </script>
  {% endif %}


</body>

</html>